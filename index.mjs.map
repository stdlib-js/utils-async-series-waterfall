{"version":3,"file":"index.mjs","sources":["../lib/factory.js","../lib/waterfall.js","../lib/index.js"],"sourcesContent":["/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar isFunctionArray = require( '@stdlib/assert-is-function-array' );\nvar isFunction = require( '@stdlib/assert-is-function' );\nvar format = require( '@stdlib/string-format' );\n\n\n// MAIN //\n\n/**\n* Returns a reusable waterfall function.\n*\n* @param {FunctionArray} fcns - array of functions\n* @param {Callback} clbk - callback to invoke upon completion\n* @param {*} [thisArg] - function context\n* @throws {TypeError} first argument must be an array of functions\n* @throws {TypeError} second argument must be a function\n* @returns {Function} waterfall function\n*\n* @example\n* function foo( next ) {\n*     next( null, 'beep' );\n* }\n*\n* function bar( str, next ) {\n*     console.log( str );\n*     // => 'beep'\n*\n*     next();\n* }\n*\n* function done( error ) {\n*     if ( error ) {\n*         throw error;\n*     }\n* }\n*\n* var fcns = [ foo, bar ];\n*\n* var waterfall = factory( fcns, done );\n*\n* waterfall();\n* waterfall();\n* waterfall();\n*/\nfunction factory( fcns, clbk, thisArg ) {\n\tif ( !isFunctionArray( fcns ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. First argument must be a function array. Value: `%s`.', fcns ) );\n\t}\n\tif ( !isFunction( clbk ) ) {\n\t\tthrow new TypeError( format( 'invalid argument. Second argument must be a function. Value: `%s`.', clbk ) );\n\t}\n\treturn waterfall;\n\n\t/**\n\t* Executes functions in series, passing the results of one function as arguments to the next function.\n\t*\n\t* @private\n\t*/\n\tfunction waterfall() {\n\t\tvar idx = -1;\n\t\tnext(); // eslint-disable-line node/callback-return\n\n\t\t/**\n\t\t* Executes the next function in the series.\n\t\t*\n\t\t* @private\n\t\t* @param {(Error|null)} error - error object\n\t\t* @param {...*} args - results to pass to next callback\n\t\t* @returns {void}\n\t\t*/\n\t\tfunction next() {\n\t\t\tvar args;\n\t\t\tvar len;\n\t\t\tvar i;\n\n\t\t\t// Check for an error...\n\t\t\tif ( arguments[ 0 ] ) {\n\t\t\t\treturn clbk( arguments[ 0 ] );\n\t\t\t}\n\t\t\t// Update the counter and check if we have run all functions...\n\t\t\tidx += 1;\n\t\t\tif ( idx >= fcns.length ) {\n\t\t\t\treturn clbk();\n\t\t\t}\n\t\t\t// Copy the remaining arguments...\n\t\t\tlen = arguments.length;\n\t\t\targs = new Array( len );\n\t\t\tfor ( i = 0; i < len-1; i++ ) {\n\t\t\t\targs[ i ] = arguments[ i+1 ];\n\t\t\t}\n\t\t\t// Add the callback:\n\t\t\targs[ i ] = next;\n\n\t\t\t// Apply the arguments to the next function in the waterfall:\n\t\t\tfcns[ idx ].apply( thisArg, args );\n\t\t}\n\t}\n}\n\n\n// EXPORTS //\n\nmodule.exports = factory;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n// MODULES //\n\nvar factory = require( './factory.js' );\n\n\n// MAIN //\n\n/**\n* Executes functions in series, passing the results of one function as arguments to the next function.\n*\n* @param {FunctionArray} fcns - array of functions\n* @param {Callback} clbk - callback to invoke upon completion\n* @param {*} [thisArg] - function context\n* @throws {TypeError} first argument must be an array of functions\n* @throws {TypeError} second argument must be a function\n*\n* @example\n* function foo( next ) {\n*     next( null, 'beep' );\n* }\n*\n* function bar( str, next ) {\n*     console.log( str );\n*     // => 'beep'\n*\n*     next();\n* }\n*\n* function done( error ) {\n*     if ( error ) {\n*         throw error;\n*     }\n* }\n*\n* var fcns = [ foo, bar ];\n*\n* waterfall( fcns, done );\n*/\nfunction waterfall( fcns, clbk, thisArg ) {\n\tfactory( fcns, clbk, thisArg )();\n}\n\n\n// EXPORTS //\n\nmodule.exports = waterfall;\n","/**\n* @license Apache-2.0\n*\n* Copyright (c) 2018 The Stdlib Authors.\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*    http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n*/\n\n'use strict';\n\n/**\n* Execute functions in series, passing the results of one function as arguments to the next function.\n*\n* @module @stdlib/utils-async-series-waterfall\n*\n* @example\n* var waterfall = require( '@stdlib/utils-async-series-waterfall' );\n*\n* function foo( next ) {\n*     next( null, 'beep' );\n* }\n*\n* function bar( str, next ) {\n*     console.log( str );\n*     // => 'beep'\n*\n*     next();\n* }\n*\n* function done( error ) {\n*     if ( error ) {\n*         throw error;\n*     }\n* }\n*\n* var fcns = [ foo, bar ];\n*\n* waterfall( fcns, done );\n*/\n\n// MODULES //\n\nvar setReadOnly = require( '@stdlib/utils-define-nonenumerable-read-only-property' );\nvar waterfall = require( './waterfall.js' );\nvar factory = require( './factory.js' );\n\n\n// MAIN //\n\nsetReadOnly( waterfall, 'factory', factory );\n\n\n// EXPORTS //\n\nmodule.exports = waterfall;\n"],"names":["isFunctionArray","require$$0","isFunction","require$$1","format","require$$2","factory_1","fcns","clbk","thisArg","TypeError","idx","next","args","len","i","arguments","length","Array","apply","factory","waterfall","lib"],"mappings":";;oXAsBA,IAAIA,EAAkBC,EAClBC,EAAaC,EACbC,EAASC,EAmGb,IAAAC,EA1DA,SAAkBC,EAAMC,EAAMC,GAC7B,IAAMT,EAAiBO,GACtB,MAAM,IAAIG,UAAWN,EAAQ,0EAA2EG,IAEzG,IAAML,EAAYM,GACjB,MAAM,IAAIE,UAAWN,EAAQ,qEAAsEI,IAEpG,OAOA,WACC,IAAIG,GAAO,GAWX,SAASC,IACR,IAAIC,EACAC,EACAC,EAGJ,GAAKC,UAAW,GACf,OAAOR,EAAMQ,UAAW,IAIzB,IADAL,GAAO,IACKJ,EAAKU,OAChB,OAAOT,IAKR,IAFAM,EAAME,UAAUC,OAChBJ,EAAO,IAAIK,MAAOJ,GACZC,EAAI,EAAGA,EAAID,EAAI,EAAGC,IACvBF,EAAME,GAAMC,UAAWD,EAAE,GAG1BF,EAAME,GAAMH,EAGZL,EAAMI,GAAMQ,MAAOV,EAASI,GAlC7BD,KC3DEQ,EAAUnB,EA2Cd,ICZAoB,EDKA,SAAoBd,EAAMC,EAAMC,GAC/BW,EAASb,EAAMC,EAAMC,EAArBW,ICLDA,EAAAf,EAFAJ,EAOAoB,EAAA,UAAAD,GAKA,IAAAE,EAAAD"}